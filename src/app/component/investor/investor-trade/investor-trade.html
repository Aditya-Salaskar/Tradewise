<div class="trade-page">
  <header class="trade-header">
    <h2>Trade</h2>
    <div class="message" *ngIf="message">{{ message }}</div>
  </header>

  <section class="trade-form">
    <div class="form-row">
      <label>Instrument
        <select [(ngModel)]="selectedInstrument">
          <option value="">-- select --</option>
          <option *ngFor="let i of instruments" [value]="i">{{ i }}</option>
        </select>
      </label>

      <label>Side
        <select [(ngModel)]="side">
          <option value="BUY">Buy</option>
          <option value="SELL">Sell</option>
        </select>
      </label>

      <label>Order Type
        <select [(ngModel)]="orderType">
          <option value="MARKET">Market</option>
          <option value="LIMIT">Limit</option>
        </select>
      </label>

      <label>Quantity
        <input type="number" [(ngModel)]="quantity" min="1" />
      </label>

      <label>Price
        <input type="number" [(ngModel)]="price" [disabled]="orderType === 'MARKET'" step="0.01" />
      </label>

      <div class="form-actions">
        <button (click)="placeOrder()">Place Order</button>
      </div>
    </div>
  </section>

  <section class="tables">
    <div class="table-col">
      <h3>Assets</h3>
      <div *ngIf="loadingBought" class="loading">Loading...</div>
      <table *ngIf="!loadingBought">
        <thead>
          <tr>
            <th>Instrument</th>
            <th>Qty</th>
            <th>Price</th>
            <th>Status</th>
            <th>Timestamp</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let b of boughtTrades">
            <td>{{ b.instrument }}</td>
            <td>{{ b.quantity }}</td>
            <td>{{ b.price }}</td>
            <td>{{ b.status }}</td>
            <td>{{ b.timestamp | date:'short' }}</td>
            <td><button (click)="sellBought(b)" [disabled]="b.status !== 'BOUGHT'">Sell</button></td>
          </tr>
          <tr *ngIf="boughtTrades.length === 0"><td colspan="6">No bought trades</td></tr>
        </tbody>
      </table>
    </div>

    <div class="table-col">
      <h3>Market Offers</h3>
      <div *ngIf="loadingMarket" class="loading">Loading...</div>
      <table *ngIf="!loadingMarket">
        <thead>
          <tr>
            <th>Instrument</th>
            <th>Available</th>
            <th>Price</th>
            <th>Type</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let m of marketOffers">
            <td>{{ m.instrument }}</td>
            <td>{{ m.availableQuantity }}</td>
            <td>{{ m.price }}</td>
            <td>{{ m.type }}</td>
            <td><button (click)="buyFromMarket(m)" [disabled]="m.availableQuantity <= 0">Buy</button></td>
          </tr>
          <tr *ngIf="marketOffers.length === 0"><td colspan="5">No market offers</td></tr>
        </tbody>
      </table>
    </div>
  </section>
</div>
